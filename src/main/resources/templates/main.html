<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë©”ì¸ ë©”ë‰´</title>
</head>
<body>
  <h2>ë©”ì¸ ë©”ë‰´</h2>
  <div id="userInfo"></div>
  <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>

  <h3>ğŸ“‚ ë°”ë¡œê°€ê¸° ëª©ë¡</h3>
  <ul id="shortcutList"></ul>

  <h3>â• ë°”ë¡œê°€ê¸° ì¶”ê°€</h3>
  <form id="shortcutForm">
    ê²½ë¡œ: <input type="text" id="path" required><br>
    ì´ë¦„: <input type="text" id="name" required><br>
    ì´ë¯¸ì§€ íŒŒì¼: <input type="file" id="image" accept="image/*" required><br>
    <button type="submit">ì¶”ê°€í•˜ê¸°</button>
  </form>

  <script>
    let userId = null;

    async function fetchUserInfo() {
      const token = localStorage.getItem("token");
      if (!token) {
        alert("ë¡œê·¸ì¸ í•„ìš”");
        location.href = "/login";
        return;
      }

      const response = await fetch("/api/users/me", {
        headers: { "Authorization": "Bearer " + token }
      });

      if (response.ok) {
        const user = await response.json();
        document.getElementById("userInfo").innerText = `í™˜ì˜í•©ë‹ˆë‹¤, ${user.username}ë‹˜!`;
        userId = user.id;
        loadShortcuts(); // ìœ ì € ì •ë³´ ê°€ì ¸ì˜¨ í›„ ë°”ë¡œê°€ê¸°ë„ ë¶ˆëŸ¬ì˜¤ê¸°
      } else {
        alert("ì¸ì¦ ì‹¤íŒ¨. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
        localStorage.removeItem("token");
        location.href = "/login";
      }
    }

    async function loadShortcuts() {
      const token = localStorage.getItem("token");
      const response = await fetch(`/api/shortcuts/${userId}`, {
        headers: { "Authorization": "Bearer " + token }
      });

      if (response.ok) {
        const shortcuts = await response.json();
        const list = document.getElementById("shortcutList");
        list.innerHTML = "";
        shortcuts.forEach(s => {
          const item = document.createElement("li");
          item.innerHTML = `<img src="${s.image}" alt="" width="24"> <strong>${s.name}</strong> (${s.path})`;
          list.appendChild(item);
        });
      } else {
        console.error("ë°”ë¡œê°€ê¸° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", response.status);
        alert("ë°”ë¡œê°€ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
      }
    }

    document.getElementById("shortcutForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const token = localStorage.getItem("token");

  const formData = new FormData();
  formData.append("path", document.getElementById("path").value);
  formData.append("name", document.getElementById("name").value);
  formData.append("image", document.getElementById("image").files[0]); // ğŸ” íŒŒì¼ ê°ì²´ ì „ì†¡

  const response = await fetch(`/api/shortcuts/${userId}/create`, {
    method: "POST",
    headers: {
      "Authorization": "Bearer " + token
    },
    body: formData // âš  JSON ì•„ë‹˜
  });

  if (response.ok) {
    alert("ë°”ë¡œê°€ê¸° ìƒì„± ì™„ë£Œ");
    loadShortcuts();
    document.getElementById("shortcutForm").reset();
  } else {
    alert("ìƒì„± ì‹¤íŒ¨");
  }
});


    function logout() {
      localStorage.removeItem("token");
      location.href = "/login";
    }

    fetchUserInfo();
  </script>
</body>
</html>
